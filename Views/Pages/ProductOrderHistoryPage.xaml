<UserControl x:Class="gentech_services.Views.Pages.ProductOrderHistoryPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:gentech_services.Views.Pages"
             mc:Ignorable="d"
             d:DesignHeight="900" d:DesignWidth="1400" Background="White">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>
    <Grid>
        <Grid Margin="32,24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="24"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

        <!-- Header with Gray Background -->
        <Border Grid.Row="0" Background="#EFEFEF" Padding="16" CornerRadius="8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="16"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Text="Product Order History"
                           FontSize="28"
                           FontWeight="Bold"
                           Foreground="#1E1E1E"
                           VerticalAlignment="Center"/>

                <!-- Search -->
                <Border Grid.Column="1"
                        Background="White"
                        BorderBrush="Black"
                        BorderThickness="1"
                        CornerRadius="8">
                    <TextBox Style="{StaticResource OutlineTextBox}"
                             Tag="Search by Order Number"
                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                             Width="280"
                             Height="38"
                             FontSize="13"
                             BorderThickness="0"
                             Background="Transparent"
                             VerticalContentAlignment="Center"/>
                </Border>

                <!-- Payment Status Filter -->
                <Border Grid.Column="3"
                        Background="White"
                        BorderBrush="Black"
                        BorderThickness="1"
                        CornerRadius="8">
                    <ComboBox Style="{StaticResource OutlineComboBox}"
                              Tag="Payment Status"
                              SelectedValue="{Binding SelectedPaymentStatus}"
                              SelectedValuePath="Content"
                              Width="200"
                              Height="38"
                              FontSize="13"
                              BorderThickness="0"
                              Background="Transparent">
                        <ComboBoxItem Content="Paid"/>
                        <ComboBoxItem Content="Partially Returned"/>
                        <ComboBoxItem Content="Fully Returned"/>
                        <ComboBoxItem Content="Voided"/>
                    </ComboBox>
                </Border>
            </Grid>
        </Border>

        <!-- Table Container -->
        <Border Grid.Row="2"
                Background="White"
                BorderBrush="Black"
                BorderThickness="1"
                CornerRadius="8"
                Padding="0"
                ClipToBounds="True">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Table Header -->
                <Border Grid.Row="0"
                        Background="White"
                        BorderThickness="0"
                        CornerRadius="8,8,0,0"
                        Padding="24,16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="80"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="ORDER NO." FontWeight="Bold" FontSize="13" Foreground="#333"/>
                        <TextBlock Grid.Column="1" Text="CUSTOMER" FontWeight="Bold" FontSize="13" Foreground="#333"/>
                        <TextBlock Grid.Column="2" Text="DATE" FontWeight="Bold" FontSize="13" Foreground="#333"/>
                        <TextBlock Grid.Column="3" Text="TOTAL ITEMS" FontWeight="Bold" FontSize="13" Foreground="#333"/>
                        <TextBlock Grid.Column="4" Text="TOTAL COST" FontWeight="Bold" FontSize="13" Foreground="#333"/>
                        <TextBlock Grid.Column="5" Text="PAYMENT STATUS" FontWeight="Bold" FontSize="13" Foreground="#333"/>
                        <TextBlock Grid.Column="6" Text="ACTION" FontWeight="Bold" FontSize="13" Foreground="#333" TextAlignment="Center"/>
                    </Grid>
                </Border>

                <!-- Table Content -->
                <Border Grid.Row="1" CornerRadius="0,0,8,8" ClipToBounds="True">
                <ScrollViewer Style="{StaticResource CustomScrollViewer}"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled"
                              MaxHeight="600">
                    <ItemsControl ItemsSource="{Binding FilteredOrders}" Padding="0" AlternationCount="2">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource AlternatingRow}"
                                        CornerRadius="5"
                                        Padding="24,16"
                                        Margin="4,2">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="150"/>
                                            <ColumnDefinition Width="80"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Order Number -->
                                        <TextBlock Grid.Column="0"
                                                   Text="{Binding OrderNumber}"
                                                   FontSize="14"
                                                   VerticalAlignment="Center"
                                                   Foreground="#333"/>

                                        <!-- Customer -->
                                        <TextBlock Grid.Column="1"
                                                   Text="{Binding CustomerName}"
                                                   FontSize="14"
                                                   VerticalAlignment="Center"
                                                   Foreground="#333"
                                                   FontWeight="SemiBold"/>

                                        <!-- Date -->
                                        <TextBlock Grid.Column="2"
                                                   Text="{Binding OrderDate, StringFormat='MM/dd/yyyy'}"
                                                   FontSize="14"
                                                   VerticalAlignment="Center"
                                                   Foreground="#666"/>

                                        <!-- Total Items -->
                                        <TextBlock Grid.Column="3"
                                                   FontSize="14"
                                                   VerticalAlignment="Center"
                                                   Foreground="#333">
                                            <Run Text="{Binding TotalItems}"/>
                                            <Run Text=" items"/>
                                        </TextBlock>

                                        <!-- Total Cost -->
                                        <TextBlock Grid.Column="4"
                                                   Text="{Binding TotalCost, StringFormat='₱ {0:N2}'}"
                                                   FontSize="14"
                                                   VerticalAlignment="Center"
                                                   Foreground="#333"/>

                                        <!-- Payment Status -->
                                        <Border Grid.Column="5"
                                                Background="#1A0000FF"
                                                CornerRadius="20"
                                                Padding="20,8"
                                                MinWidth="80"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Center">
                                            <TextBlock FontSize="14"
                                                       FontWeight="SemiBold"
                                                       TextAlignment="Center"
                                                       HorizontalAlignment="Center"
                                                       Text="{Binding PaymentStatus}">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Foreground" Value="#0000FF"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding PaymentStatus}" Value="Paid">
                                                                <Setter Property="Foreground" Value="#2E7D32"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding PaymentStatus}" Value="Partially Returned">
                                                                <Setter Property="Foreground" Value="#F57C00"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding PaymentStatus}" Value="Fully Returned">
                                                                <Setter Property="Foreground" Value="#0000FF"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding PaymentStatus}" Value="Voided">
                                                                <Setter Property="Foreground" Value="#C62828"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </Border>

                                        <!-- Action Button -->
                                        <Button Grid.Column="6"
                                                Style="{StaticResource KebabMenuButton}"
                                                Background="White"
                                                BorderBrush="Black"
                                                BorderThickness="1"
                                                Width="32"
                                                Height="32"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Click="OrderActionButton_Click">
                                            <Button.Resources>
                                                <Style TargetType="Border">
                                                    <Setter Property="CornerRadius" Value="5"/>
                                                </Style>
                                            </Button.Resources>
                                        </Button>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
                </Border>
            </Grid>
        </Border>
        </Grid>

        <!-- Action Menu Popup -->
        <Popup x:Name="OrderActionPopup"
           StaysOpen="False"
           AllowsTransparency="True"
           Placement="Left"
           HorizontalOffset="0"
           VerticalOffset="35">
        <Border Background="White"
                BorderBrush="Black"
                BorderThickness="1"
                CornerRadius="5"
                Padding="8">
            <Border.Effect>
                <DropShadowEffect Color="Black" Opacity="0.15" BlurRadius="10" ShadowDepth="2"/>
            </Border.Effect>
            <StackPanel Width="200">
                <!-- View Button -->
                <Button Height="40"
                        Background="#EEEEEE"
                        BorderThickness="0"
                        Cursor="Hand"
                        Margin="0,0,0,8"
                        Click="ViewOrder_Click">
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="5"/>
                        </Style>
                    </Button.Resources>
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                x:Name="Border"
                                                BorderThickness="0"
                                                CornerRadius="5"
                                                Padding="12,8">
                                            <TextBlock Text="View"
                                                       Foreground="Black"
                                                       FontSize="14"
                                                       FontWeight="SemiBold"
                                                       HorizontalAlignment="Left"
                                                       VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Border" Property="Background" Value="#DDDDDD"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                </Button>

                <!-- Return Button -->
                <Button Height="40"
                        Background="#0000FF"
                        BorderThickness="0"
                        Cursor="Hand"
                        Margin="0,0,0,8"
                        Click="ReturnOrder_Click">
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="5"/>
                        </Style>
                    </Button.Resources>
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                x:Name="Border"
                                                BorderThickness="0"
                                                CornerRadius="5"
                                                Padding="12,8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Flip-Left Icon -->
                                                <Viewbox Grid.Column="0" Width="20" Height="20" Margin="0,0,12,0">
                                                    <Canvas Width="24" Height="24">
                                                        <Path Data="M19 7v4H5.83l3.58-3.59L8 6l-6 6 6 6 1.41-1.41L5.83 13H21V7h-2z" Fill="White"/>
                                                    </Canvas>
                                                </Viewbox>

                                                <TextBlock Grid.Column="1"
                                                           Text="Return"
                                                           Foreground="White"
                                                           FontSize="14"
                                                           FontWeight="SemiBold"
                                                           VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Border" Property="Background" Value="#0000CC"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                </Button>

                <!-- Void Button -->
                <Button Height="40"
                        Background="#FF0000"
                        BorderThickness="0"
                        Cursor="Hand"
                        Click="VoidOrder_Click">
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="5"/>
                        </Style>
                    </Button.Resources>
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                x:Name="Border"
                                                BorderThickness="0"
                                                CornerRadius="5"
                                                Padding="12,8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Void Icon (Circle with line) -->
                                                <Viewbox Grid.Column="0" Width="20" Height="20" Margin="0,0,12,0">
                                                    <Canvas Width="24" Height="24">
                                                        <Path Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z" Fill="White"/>
                                                        <Path Data="M7 11h10v2H7z" Fill="White"/>
                                                    </Canvas>
                                                </Viewbox>

                                                <TextBlock Grid.Column="1"
                                                           Text="Void"
                                                           Foreground="White"
                                                           FontSize="14"
                                                           FontWeight="SemiBold"
                                                           VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Border" Property="Background" Value="#CC0000"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                </Button>
            </StackPanel>
        </Border>
        </Popup>

        <!-- Order Details Modal -->
        <Grid Background="#80000000"
              Visibility="{Binding IsOrderDetailsVisible, Converter={StaticResource BooleanToVisibilityConverter}}"
              Margin="-32,-24">
            <Border Background="White"
                    BorderBrush="Black"
                    BorderThickness="1"
                    CornerRadius="12"
                    Width="900"
                    MaxHeight="600"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    Padding="24">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="20"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="20"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Modal Header -->
                    <Grid Grid.Row="0">
                        <TextBlock Text="Order Details"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="#1E1E1E"
                                   VerticalAlignment="Center"/>
                        <Button Content="✕"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Top"
                                Width="28"
                                Height="28"
                                FontSize="18"
                                Background="Transparent"
                                BorderThickness="0"
                                Foreground="#666"
                                Cursor="Hand"
                                Click="CloseOrderDetails_Click">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}"
                                                        CornerRadius="14">
                                                    <TextBlock Text="{TemplateBinding Content}"
                                                               FontSize="{TemplateBinding FontSize}"
                                                               Foreground="{TemplateBinding Foreground}"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#F0F0F0"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Button.Style>
                        </Button>
                    </Grid>

                    <!-- Order Details Table -->
                    <Grid Grid.Row="2">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Table Header -->
                        <Border Grid.Row="0"
                                Background="#F5F5F5"
                                Padding="16,12">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="80"/>
                                    <ColumnDefinition Width="2*"/>
                                    <ColumnDefinition Width="1.5*"/>
                                    <ColumnDefinition Width="1*"/>
                                    <ColumnDefinition Width="1.2*"/>
                                    <ColumnDefinition Width="1.2*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" Text="Product" FontWeight="Bold" FontSize="13"/>
                                <TextBlock Grid.Column="1" Text="Name" FontWeight="Bold" FontSize="13"/>
                                <TextBlock Grid.Column="2" Text="Category" FontWeight="Bold" FontSize="13"/>
                                <TextBlock Grid.Column="3" Text="Quantity" FontWeight="Bold" FontSize="13"/>
                                <TextBlock Grid.Column="4" Text="Unit Price" FontWeight="Bold" FontSize="13"/>
                                <TextBlock Grid.Column="5" Text="Subtotal" FontWeight="Bold" FontSize="13"/>
                            </Grid>
                        </Border>

                        <!-- Table Rows -->
                        <ScrollViewer Grid.Row="1"
                                      VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Disabled"
                                      MaxHeight="300">
                            <ItemsControl ItemsSource="{Binding OrderDetailsItems}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="16,12"
                                                Background="#F5F5F5">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="80"/>
                                                    <ColumnDefinition Width="2*"/>
                                                    <ColumnDefinition Width="1.5*"/>
                                                    <ColumnDefinition Width="1*"/>
                                                    <ColumnDefinition Width="1.2*"/>
                                                    <ColumnDefinition Width="1.2*"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0" Text="{Binding ProductId}" FontSize="14" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="1" Text="{Binding Name}" FontSize="14" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="2" Text="{Binding Category}" FontSize="14" VerticalAlignment="Center" Foreground="#666"/>

                                                <!-- Quantity with returned info -->
                                                <StackPanel Grid.Column="3" VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding Quantity}" FontSize="14"/>
                                                    <TextBlock Visibility="{Binding HasReturns, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                               FontSize="12"
                                                               Foreground="Red">
                                                        <Run Text="("/><Run Text="{Binding ReturnedQuantity}"/><Run Text=" returned)"/>
                                                    </TextBlock>
                                                </StackPanel>

                                                <TextBlock Grid.Column="4" Text="{Binding UnitPrice, StringFormat='₱ {0:N0}'}" FontSize="14" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="5" Text="{Binding Subtotal, StringFormat='₱ {0:N0}'}" FontSize="14" VerticalAlignment="Center" FontWeight="SemiBold"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>

                    <!-- Total -->
                    <TextBlock Grid.Row="4"
                               HorizontalAlignment="Left"
                               FontSize="16"
                               FontWeight="Bold">
                        <Run Text="Total:"/>
                        <Run Text="{Binding OrderDetailsTotal, StringFormat='₱ {0:N0}'}"/>
                    </TextBlock>
                </Grid>
            </Border>
        </Grid>

        <!-- Process Return Modal -->
        <Grid Background="#80000000"
              Visibility="{Binding IsReturnModalVisible, Converter={StaticResource BooleanToVisibilityConverter}}"
              Margin="-32,-24">
            <Border Background="White"
                    BorderBrush="Black"
                    BorderThickness="1"
                    CornerRadius="12"
                    Width="550"
                    MaxHeight="600"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    Padding="24">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="16"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="20"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="20"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="16"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Modal Header -->
                    <Grid Grid.Row="0">
                        <TextBlock Text="Process Return"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="#1E1E1E"
                                   VerticalAlignment="Center"/>
                        <Button Content="✕"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Top"
                                Width="28"
                                Height="28"
                                FontSize="18"
                                Background="Transparent"
                                BorderThickness="0"
                                Foreground="#666"
                                Cursor="Hand"
                                Click="CloseReturnModal_Click">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}"
                                                        CornerRadius="14">
                                                    <TextBlock Text="{TemplateBinding Content}"
                                                               FontSize="{TemplateBinding FontSize}"
                                                               Foreground="{TemplateBinding Foreground}"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#F0F0F0"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Button.Style>
                        </Button>
                    </Grid>

                    <!-- Order Number and Date -->
                    <TextBlock Grid.Row="2"
                               FontSize="13"
                               Foreground="#666">
                        <Run Text="#PO-001" FontWeight="SemiBold"/>
                        <Run Text=" 02-05-2025, 9:00:00 PM"/>
                    </TextBlock>

                    <!-- Instruction Text -->
                    <TextBlock Grid.Row="4"
                               Text="Select items and quantities to return"
                               FontSize="13"
                               Foreground="#666"
                               VerticalAlignment="Top"/>

                    <!-- Return Items List -->
                    <ScrollViewer Grid.Row="4"
                                  Style="{StaticResource CustomScrollViewer}"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled"
                                  MaxHeight="250"
                                  Margin="0,30,0,0">
                        <ItemsControl ItemsSource="{Binding ReturnItems}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="White"
                                            BorderBrush="Black"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="16"
                                            Margin="0,0,0,12">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="8"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="12"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <!-- Product Name and Price -->
                                            <Grid Grid.Row="0">
                                                <TextBlock Text="{Binding ProductName}"
                                                           FontSize="14"
                                                           FontWeight="SemiBold"
                                                           VerticalAlignment="Center"/>
                                                <TextBlock HorizontalAlignment="Right"
                                                           FontSize="14"
                                                           FontWeight="SemiBold">
                                                    <Run Text="₱"/>
                                                    <Run Text="{Binding UnitPrice, StringFormat='{}{0:N0}'}"/>
                                                </TextBlock>
                                            </Grid>

                                            <!-- Original Quantity and Returned -->
                                            <TextBlock Grid.Row="2"
                                                       FontSize="12"
                                                       Foreground="#666">
                                                <Run Text="Original:"/>
                                                <Run Text="{Binding OriginalQuantity, Mode=OneWay}"/>
                                                <Run Text=" × ₱"/>
                                                <Run Text="{Binding UnitPrice, StringFormat='{}{0:N0}', Mode=OneWay}"/>
                                                <Run Text=" "/>
                                                <Run Text="(Available: " Foreground="#666"/>
                                                <Run Text="{Binding AvailableQuantity, Mode=OneWay}" Foreground="#666"/>
                                                <Run Text=")" Foreground="#666"/>
                                            </TextBlock>

                                            <!-- Return Quantity Controls -->
                                            <StackPanel Grid.Row="4" Orientation="Horizontal">
                                                <TextBlock Text="Return quantity:"
                                                           FontSize="13"
                                                           Foreground="#666"
                                                           VerticalAlignment="Center"
                                                           Margin="0,0,12,0"/>

                                                <!-- Decrease Button -->
                                                <Button Width="32"
                                                        Height="32"
                                                        Background="#E5E5E5"
                                                        BorderBrush="#808080"
                                                        BorderThickness="1"
                                                        Cursor="Hand"
                                                        Command="{Binding DataContext.DecreaseReturnQuantityCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                        CommandParameter="{Binding}">
                                                    <Button.Resources>
                                                        <Style TargetType="Border">
                                                            <Setter Property="CornerRadius" Value="6"/>
                                                        </Style>
                                                    </Button.Resources>
                                                    <Button.Style>
                                                        <Style TargetType="Button">
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate TargetType="Button">
                                                                        <Border Background="{TemplateBinding Background}"
                                                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                                                CornerRadius="6"
                                                                                Padding="8">
                                                                            <Image Source="pack://application:,,,/gentech_services;component/Resources/Assets/Icons/minus.png"
                                                                                   Width="16"
                                                                                   Height="16"
                                                                                   Stretch="Uniform"
                                                                                   HorizontalAlignment="Center"
                                                                                   VerticalAlignment="Center"/>
                                                                        </Border>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Style>
                                                    </Button.Style>
                                                </Button>

                                                <!-- Quantity Display -->
                                                <Border Width="50"
                                                        Height="32"
                                                        Background="White"
                                                        Margin="8,0">
                                                    <TextBlock Text="{Binding ReturnQuantity}"
                                                               FontSize="14"
                                                               FontWeight="SemiBold"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center"/>
                                                </Border>

                                                <!-- Increase Button -->
                                                <Button Width="32"
                                                        Height="32"
                                                        Background="#E5E5E5"
                                                        BorderBrush="#808080"
                                                        BorderThickness="1"
                                                        Cursor="Hand"
                                                        Command="{Binding DataContext.IncreaseReturnQuantityCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                        CommandParameter="{Binding}">
                                                    <Button.Resources>
                                                        <Style TargetType="Border">
                                                            <Setter Property="CornerRadius" Value="6"/>
                                                        </Style>
                                                    </Button.Resources>
                                                    <Button.Style>
                                                        <Style TargetType="Button">
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate TargetType="Button">
                                                                        <Border Background="{TemplateBinding Background}"
                                                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                                                CornerRadius="6"
                                                                                Padding="8">
                                                                            <Image Source="pack://application:,,,/gentech_services;component/Resources/Assets/Icons/plus.png"
                                                                                   Width="16"
                                                                                   Height="16"
                                                                                   Stretch="Uniform"
                                                                                   HorizontalAlignment="Center"
                                                                                   VerticalAlignment="Center"/>
                                                                        </Border>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Style>
                                                    </Button.Style>
                                                </Button>

                                                <!-- "of X" text -->
                                                <TextBlock Margin="8,0,0,0"
                                                           FontSize="13"
                                                           Foreground="#666"
                                                           VerticalAlignment="Center">
                                                    <Run Text="of"/>
                                                    <Run Text="{Binding AvailableQuantity, Mode=OneWay}"/>
                                                </TextBlock>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>

                    <!-- Total Refund -->
                    <Border Grid.Row="6"
                            Background="#E3F2FD"
                            CornerRadius="8"
                            Padding="16,12">
                        <Grid>
                            <TextBlock Text="Total Refund:"
                                       FontSize="14"
                                       FontWeight="SemiBold"
                                       VerticalAlignment="Center"/>
                            <TextBlock HorizontalAlignment="Right"
                                       FontSize="14"
                                       FontWeight="SemiBold">
                                <Run Text="₱"/>
                                <Run Text="{Binding TotalRefund, StringFormat='{}{0:N0}'}"/>
                            </TextBlock>
                        </Grid>
                    </Border>

                    <!-- Action Buttons -->
                    <Grid Grid.Row="8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Cancel Button -->
                        <Button Grid.Column="0"
                                Content="Cancel"
                                Height="40"
                                FontSize="14"
                                FontWeight="SemiBold"
                                Background="White"
                                Foreground="Black"
                                BorderBrush="Black"
                                BorderThickness="1"
                                Cursor="Hand"
                                Click="CloseReturnModal_Click">
                            <Button.Resources>
                                <Style TargetType="Border">
                                    <Setter Property="CornerRadius" Value="8"/>
                                </Style>
                            </Button.Resources>
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}"
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="8"
                                                        x:Name="Border">
                                                    <TextBlock Text="{TemplateBinding Content}"
                                                               FontSize="{TemplateBinding FontSize}"
                                                               FontWeight="{TemplateBinding FontWeight}"
                                                               Foreground="{TemplateBinding Foreground}"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="Border" Property="Background" Value="#F5F5F5"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Button.Style>
                        </Button>

                        <!-- Process Return Button -->
                        <Button Grid.Column="2"
                                Content="Process Return"
                                Height="40"
                                FontSize="14"
                                FontWeight="SemiBold"
                                Background="#0000FF"
                                Foreground="White"
                                BorderThickness="0"
                                Cursor="Hand"
                                Command="{Binding ProcessReturnCommand}">
                            <Button.Resources>
                                <Style TargetType="Border">
                                    <Setter Property="CornerRadius" Value="8"/>
                                </Style>
                            </Button.Resources>
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}"
                                                        CornerRadius="8"
                                                        x:Name="Border">
                                                    <TextBlock Text="{TemplateBinding Content}"
                                                               FontSize="{TemplateBinding FontSize}"
                                                               FontWeight="{TemplateBinding FontWeight}"
                                                               Foreground="{TemplateBinding Foreground}"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="Border" Property="Background" Value="#0000CC"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Button.Style>
                        </Button>
                    </Grid>
                </Grid>
            </Border>
        </Grid>

        <!-- Void Transaction Modal -->
        <Grid Visibility="{Binding IsVoidModalVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
            <!-- Semi-transparent background -->
            <Border Background="#80000000" />

            <!-- Modal Content -->
            <Border Background="White"
                    CornerRadius="12"
                    Width="500"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center"
                    Padding="32,24,32,24">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <Border Grid.Row="0"
                            Background="Transparent"
                            Padding="0">
                        <StackPanel>
                            <!-- Warning Icon Circle -->
                            <Border Width="60"
                                    Height="60"
                                    Background="#FFF5F5"
                                    CornerRadius="30"
                                    HorizontalAlignment="Left"
                                    Margin="0,0,0,16">
                                <Border Width="40"
                                        Height="40"
                                        Background="#FEE2E2"
                                        CornerRadius="20"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center">
                                    <TextBlock Text="!"
                                              FontSize="24"
                                              FontWeight="Bold"
                                              Foreground="#DC2626"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                                </Border>
                            </Border>
                            <TextBlock Text="Void This Transaction?"
                                      FontSize="20"
                                      FontWeight="Bold"
                                      VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Body -->
                    <ScrollViewer Grid.Row="1"
                                  Style="{StaticResource CustomScrollViewer}"
                                  VerticalScrollBarVisibility="Auto"
                                  MaxHeight="400"
                                  Padding="0">
                        <StackPanel>
                            <!-- Order Info -->
                            <TextBlock FontSize="14" Foreground="#666" Margin="0,0,0,16" TextWrapping="Wrap">
                                <Run Text="This will completely cancel order "/>
                                <Run Text="{Binding SelectedOrderForVoid.OrderNumber, Mode=OneWay}" FontWeight="Bold"/>
                                <LineBreak/>
                                <Run Text="from "/>
                                <Run Text="{Binding SelectedOrderForVoid.OrderDate, StringFormat='MM-dd-yyyy', Mode=OneWay}"/>
                                <Run Text=" at 9:00:00 PM"/>
                            </TextBlock>

                            <!-- Transaction Details -->
                            <Border Background="#F9FAFB"
                                    CornerRadius="8"
                                    Padding="16"
                                    Margin="0,0,0,16">
                                <StackPanel>
                                    <TextBlock Text="Transaction Details:"
                                              FontSize="14"
                                              Margin="0,0,0,12"/>

                                    <ItemsControl ItemsSource="{Binding OrderDetailsItems}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Grid Margin="0,0,0,8">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Column="0" FontSize="13">
                                                        <Run Text="{Binding Quantity, Mode=OneWay}"/>
                                                        <Run Text="x "/>
                                                        <Run Text="{Binding Name, Mode=OneWay}"/>
                                                    </TextBlock>
                                                    <TextBlock Grid.Column="1"
                                                              FontSize="13"
                                                              FontWeight="SemiBold">
                                                        <Run Text="₱"/>
                                                        <Run Text="{Binding Subtotal, StringFormat='{}{0:N0}', Mode=OneWay}"/>
                                                    </TextBlock>
                                                </Grid>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <!-- Total -->
                                    <Border BorderBrush="#E5E7EB"
                                            BorderThickness="0,1,0,0"
                                            Padding="0,12,0,0"
                                            Margin="0,8,0,0">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0"
                                                      Text="Total:"
                                                      FontWeight="Bold"
                                                      FontSize="14"/>
                                            <TextBlock Grid.Column="1"
                                                      FontWeight="Bold"
                                                      FontSize="14">
                                                <Run Text="₱"/>
                                                <Run Text="{Binding OrderDetailsTotal, StringFormat='{}{0:N0}', Mode=OneWay}"/>
                                            </TextBlock>
                                        </Grid>
                                    </Border>
                                </StackPanel>
                            </Border>

                            <!-- Warning Message -->
                            <Border Background="#FEF3C7"
                                    BorderBrush="#F59E0B"
                                    BorderThickness="1"
                                    CornerRadius="8"
                                    Padding="16">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <Image Source="pack://application:,,,/gentech_services;component/Resources/Assets/Icons/warn_orange.png"
                                               Width="16"
                                               Height="16"
                                               Margin="0,0,8,0"
                                               VerticalAlignment="Center"/>
                                        <TextBlock Text="Important:"
                                                  FontWeight="Bold"
                                                  FontSize="13"
                                                  Foreground="#92400E"
                                                  VerticalAlignment="Center"/>
                                    </StackPanel>
                                    <TextBlock FontSize="12"
                                              Foreground="#92400E"
                                              TextWrapping="Wrap"
                                              LineHeight="18">
                                        <Run Text="• Transaction will be completely removed from sales records"/>
                                        <LineBreak/>
                                        <Run Text="• This action cannot be undone"/>
                                        <LineBreak/>
                                        <Run Text="• Consider using RETURN if customer was charged"/>
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Footer Buttons -->
                    <Grid Grid.Row="2"
                          Margin="0,20,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="8"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Cancel Button -->
                        <Button Grid.Column="0"
                                Content="Cancel"
                                Height="40"
                                FontSize="14"
                                FontWeight="SemiBold"
                                Background="White"
                                Foreground="Black"
                                BorderBrush="Black"
                                BorderThickness="1"
                                Cursor="Hand"
                                Click="CloseVoidModal_Click">
                            <Button.Resources>
                                <Style TargetType="Border">
                                    <Setter Property="CornerRadius" Value="8"/>
                                </Style>
                            </Button.Resources>
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}"
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="8"
                                                        x:Name="Border">
                                                    <TextBlock Text="{TemplateBinding Content}"
                                                               FontSize="{TemplateBinding FontSize}"
                                                               FontWeight="{TemplateBinding FontWeight}"
                                                               Foreground="{TemplateBinding Foreground}"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="Border" Property="Background" Value="#F5F5F5"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Button.Style>
                        </Button>

                        <!-- Void Transaction Button -->
                        <Button Grid.Column="2"
                                Content="Yes, Void Transaction"
                                Height="40"
                                FontSize="14"
                                FontWeight="SemiBold"
                                Background="#EF4444"
                                Foreground="White"
                                BorderThickness="0"
                                Cursor="Hand"
                                Command="{Binding VoidTransactionCommand}">
                            <Button.Resources>
                                <Style TargetType="Border">
                                    <Setter Property="CornerRadius" Value="8"/>
                                </Style>
                            </Button.Resources>
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}"
                                                        CornerRadius="8"
                                                        x:Name="Border">
                                                    <TextBlock Text="{TemplateBinding Content}"
                                                               FontSize="{TemplateBinding FontSize}"
                                                               FontWeight="{TemplateBinding FontWeight}"
                                                               Foreground="{TemplateBinding Foreground}"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="Border" Property="Background" Value="#B91C1C"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Button.Style>
                        </Button>
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>
